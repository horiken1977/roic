# ROIC分析アプリケーション 技術スタック選定基準書

## 1. 現在の環境特性

### 1.1 既存インフラ環境
- **本番環境**: AWS EC2 (Ubuntu 24.04.2 LTS)
- **Webサーバー**: Apache Tomcat 10.1.42
- **Java環境**: OpenJDK 17.0.15
- **CI/CD**: Jenkins 2.504.3 (ポート8082)
- **バージョン管理**: GitHub
- **開発環境**: VSCode + Claude Code

### 1.2 チームスキルセット
- Java/Tomcat環境での運用実績
- AWS環境での運用経験
- CI/CD自動化の実装経験

## 2. アプリケーション要件からの制約

### 2.1 機能要件からの技術的要求
| 要件 | 技術的要求 | 影響する技術選定 |
|------|-----------|----------------|
| **企業検索のオートコンプリート** | リアルタイム検索、高速レスポンス | フロントエンド状態管理、キャッシュ戦略 |
| **有価証券報告書の自動取得** | 外部API連携、非同期処理 | バックエンドフレームワーク、タスクキュー |
| **ROIC複雑計算** | 数値計算精度、計算ロジック管理 | バックエンド言語選定 |
| **リアルタイム進捗表示** | WebSocket/SSE通信 | フロントエンド・バックエンド双方向通信 |
| **大量データの比較表生成** | データ処理性能、メモリ効率 | データベース選定、キャッシュ戦略 |
| **Excel/CSV/PDFエクスポート** | ファイル生成ライブラリ | バックエンドフレームワーク |
| **グラフ・チャート表示** | データビジュアライゼーション | チャートライブラリ選定 |

### 2.2 非機能要件からの技術的要求
| 要件 | 詳細 | 影響する技術選定 |
|------|------|----------------|
| **パフォーマンス** | 企業検索500ms以内、ROIC計算3秒以内 | 高速処理言語、効率的なDB設計 |
| **可用性** | 99.5%稼働率 | 堅牢なアーキテクチャ、エラーハンドリング |
| **セキュリティ** | HTTPS、APIレート制限 | セキュリティライブラリ、認証フレームワーク |
| **ブラウザ互換性** | 主要ブラウザ対応、レスポンシブ | モダンフロントエンドフレームワーク |

### 2.3 データ特性
- **構造化データ中心**: 財務データは高度に構造化されている
- **リレーショナル性**: 企業間関係、時系列データの管理
- **更新頻度**: 四半期ごとの財務データ更新
- **データ量**: 上場企業約4,000社 × 複数年分

## 3. 技術スタック選定基準

### 3.1 フロントエンド選定基準

#### 必須要件
1. **レスポンシブデザイン対応**
2. **リアルタイムデータ更新**（WebSocket/SSE）
3. **高度なグラフ描画機能**
4. **大量データの効率的表示**（仮想スクロール等）
5. **TypeScript対応**（型安全性）

#### 評価項目
| 評価項目 | 重要度 | React | Next.js | Angular | Vue.js |
|---------|--------|-------|---------|---------|---------|
| 学習コスト | 高 | ◎ | ○ | △ | ◎ |
| パフォーマンス | 高 | ○ | ◎ | ○ | ○ |
| SEO要件 | 低 | △ | ◎ | △ | ○ |
| エコシステム | 高 | ◎ | ◎ | ○ | ○ |
| 状態管理 | 高 | ○ | ○ | ◎ | ○ |
| グラフライブラリ互換性 | 高 | ◎ | ◎ | ○ | ○ |

### 3.2 バックエンド選定基準

#### 必須要件
1. **外部API連携**（EDINET API）
2. **非同期処理**（大量データ処理）
3. **数値計算精度**
4. **Excel/PDF生成**
5. **既存Java環境との整合性**

#### 評価項目
| 評価項目 | 重要度 | Node.js | Python FastAPI | Java Spring Boot | .NET Core |
|---------|--------|---------|----------------|------------------|-----------|
| Tomcat互換性 | 高 | △ | △ | ◎ | △ |
| 開発効率 | 高 | ○ | ◎ | ○ | ○ |
| 数値計算ライブラリ | 高 | △ | ◎ | ○ | ○ |
| 非同期処理 | 高 | ◎ | ◎ | ○ | ○ |
| エクセル/PDF生成 | 中 | ○ | ◎ | ◎ | ◎ |
| チーム経験 | 中 | △ | △ | ◎ | △ |

### 3.3 データベース選定基準

#### 必須要件
1. **ACID準拠**（財務データの整合性）
2. **複雑なJOIN操作**（企業間関係）
3. **時系列データ管理**
4. **高速な集計処理**

#### 評価項目
| 評価項目 | 重要度 | PostgreSQL | MySQL | MongoDB | SQLite |
|---------|--------|------------|-------|---------|---------|
| リレーショナル機能 | 高 | ◎ | ◎ | △ | ○ |
| パフォーマンス | 高 | ◎ | ○ | ○ | △ |
| 拡張性 | 中 | ◎ | ○ | ◎ | △ |
| JSON対応 | 中 | ◎ | ○ | ◎ | △ |
| 分析関数 | 高 | ◎ | ○ | △ | ○ |

### 3.4 アーキテクチャパターン選定基準

#### 選定要因
1. **初期開発スピード**: MVP開発の速度
2. **保守性**: 長期的なメンテナンス
3. **スケーラビリティ**: 将来の機能拡張
4. **運用コスト**: インフラコスト

#### 推奨アプローチ
- **初期フェーズ**: モジュラーモノリス
  - 単一デプロイメントで管理が簡単
  - 明確なモジュール境界で将来の分割に備える
- **成長フェーズ**: 段階的マイクロサービス化
  - 計算エンジンを独立サービス化
  - APIゲートウェイパターン採用

## 4. 推奨技術スタック

### 4.1 フロントエンド
- **フレームワーク**: Next.js 14+ (React 18+)
  - 理由: SSG/ISRでパフォーマンス最適化、Reactエコシステム活用
- **言語**: TypeScript 5+
- **状態管理**: Zustand + React Query
- **UIライブラリ**: Tailwind CSS + shadcn/ui
- **グラフライブラリ**: Recharts (React特化) + D3.js (高度なカスタマイズ)

### 4.2 バックエンド
- **メイン**: Python FastAPI
  - 理由: 数値計算ライブラリ豊富、高速な非同期処理、開発効率
- **補助**: Java Spring Boot (Tomcat上で既存資産活用)
  - 既存環境との親和性、エンタープライズ機能

### 4.3 データベース
- **メインDB**: PostgreSQL 15+
  - 理由: 高度な分析関数、JSON対応、拡張性
- **キャッシュ**: Redis 7+
  - セッション管理、計算結果キャッシュ

### 4.4 インフラ・その他
- **API設計**: REST API (初期) → GraphQL (将来オプション)
- **認証**: JWT + OAuth2
- **監視**: Prometheus + Grafana
- **ログ**: ELK Stack

## 5. 移行戦略

### Phase 1: 基本機能実装（モノリス）
- Next.js + FastAPI の基本構成
- PostgreSQL単一DB
- Tomcatへのリバースプロキシ設定

### Phase 2: パフォーマンス最適化
- Redis導入
- 計算処理の非同期化
- CDN導入

### Phase 3: スケーラビリティ対応
- 計算エンジンの分離
- APIゲートウェイ導入
- マイクロサービス化検討

## 6. リスクと対策

| リスク | 対策 |
|--------|------|
| Python/FastAPIの運用経験不足 | 段階的導入、Java併用期間を設ける |
| Tomcat環境との統合複雑性 | リバースプロキシ構成、段階的移行 |
| フロントエンド技術の学習コスト | 社内勉強会、外部研修の活用 |

## 7. 決定事項サマリー

1. **フロントエンド**: Next.js + TypeScript + Recharts
2. **バックエンド**: Python FastAPI (メイン) + Java Spring Boot (補助)
3. **データベース**: PostgreSQL + Redis
4. **アーキテクチャ**: モジュラーモノリス → 段階的マイクロサービス化
5. **API**: REST API → 将来的にGraphQL検討

この技術スタックにより、要件を満たしつつ、既存環境を活かした効率的な開発が可能になります。