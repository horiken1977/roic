# ROIC分析アプリケーション 機能設計書

## 1. システム概要

### 1.1 目的
日系上場企業のROIC（投下資本利益率）を自動計算・分析・比較するWebアプリケーション

### 1.2 開発方針
- **MVP-First**: 最小限の価値ある製品から開始
- **インクリメンタル開発**: 段階的な機能追加
- **自動文書更新**: 開発進捗に応じた自動更新

## 2. 機能要件

### 2.1 実装済み機能

#### ROIC自動計算 ✅
- **ステータス**: completed
- **進捗**: 100%
- **説明**: 4つの計算方式に対応したROIC自動計算
- **優先度**: high
- **フェーズ**: Phase 1
- **ファイル**: frontend/src/components/ROICCalculator.tsx, frontend/src/utils/roicCalculations.ts

#### 企業検索・フィルタリング ✅
- **ステータス**: completed
- **進捗**: 100%
- **説明**: 効率的な企業検索とフィルタリング機能
- **優先度**: high
- **フェーズ**: Phase 1
- **ファイル**: frontend/src/app/companies/page.tsx, frontend/src/components/CompanySearch.tsx

#### 進捗ダッシュボード ✅
- **ステータス**: completed
- **進捗**: 100%
- **説明**: リアルタイムで開発状況を監視・可視化
- **優先度**: high
- **フェーズ**: Phase 1
- **ファイル**: frontend/src/app/dashboard/page.tsx, frontend/src/app/page.tsx

#### 機能設計書 ✅
- **ステータス**: completed
- **進捗**: 100%
- **説明**: システム要件・機能仕様・技術設計
- **優先度**: medium
- **フェーズ**: Phase 1
- **ファイル**: docs/functional-spec.md, frontend/src/app/functional-spec/page.tsx

#### テスト仕様書 ✅
- **ステータス**: completed
- **進捗**: 100%
- **説明**: ユニット・E2Eテストの実行状況
- **優先度**: medium
- **フェーズ**: Phase 1
- **ファイル**: frontend/src/app/test-docs/test-spec/page.tsx

### 2.2 計画中機能

#### 業界比較・ランキング 📋
- **ステータス**: planned
- **進捗**: 0%
- **説明**: 同業界内でのROIC比較とランキング表示
- **優先度**: high
- **フェーズ**: Phase 2

#### データ可視化 📋
- **ステータス**: planned
- **進捗**: 0%
- **説明**: ROICトレンドチャート・グラフ表示
- **優先度**: high
- **フェーズ**: Phase 2

#### EDINET API統合 📋
- **ステータス**: planned
- **進捗**: 0%
- **説明**: 外部APIからの財務データ取得
- **優先度**: medium
- **フェーズ**: Phase 3

## 3. 開発進捗

### 全体進捗: 75%

### Phase 1: MVP基盤構築 ✅
- **進捗**: 100%
- **説明**: 基本機能とインフラの構築
- **含む機能**: 5個

### Phase 2: コア機能拡張 📋
- **進捗**: 0%
- **説明**: 業界比較・データ可視化機能の追加
- **含む機能**: 2個

### Phase 3: データ統合 📋
- **進捗**: 0%
- **説明**: 外部API統合・データベース連携
- **含む機能**: 1個

## 3.5. インフラストラクチャ・CI/CD 🚀

### 3.5.1 CI/CDパイプライン ✅

#### Jenkins自動化パイプライン
- **ステータス**: 実装完了
- **説明**: 包括的な自動化パイプラインを構築
- **ファイル**: `/Jenkinsfile`

**パイプライン構成**:
1. **コードチェックアウト**: GitHubからの自動取得
2. **環境セットアップ**: Node.js 18, OpenJDK 17
3. **依存関係インストール**: フロントエンド・バックエンド並列処理
4. **コード品質チェック**: ESLint, Prettier, 自動修正
5. **ユニットテスト**: Jest, カバレッジレポート
6. **統合テスト**: E2E、API連携テスト
7. **セキュリティスキャン**: 依存関係脆弱性チェック、SAST
8. **ビルド**: Next.js静的サイト生成
9. **パフォーマンステスト**: 負荷テスト、レスポンス測定
10. **ステージング自動デプロイ**: AWS S3 + CloudFront
11. **ステージングテスト**: 本番と同等環境でのE2Eテスト
12. **本番デプロイ承認**: 手動承認ゲート
13. **本番デプロイ**: Blue-Green デプロイメント
14. **ヘルスチェック**: 包括的な動作確認

#### GitHub Actions補完ワークフロー
- **ステータス**: 実装完了
- **説明**: Jenkins補完のCI/CDワークフロー
- **ファイル**: `/.github/workflows/ci-cd.yml`

**主要機能**:
- プルリクエスト時の自動テスト
- mainブランチへのマージで自動デプロイ
- 環境別デプロイメント制御
- アーティファクト管理
- 通知・レポート機能

### 3.5.2 インフラストラクチャ ✅

#### AWS Cloud Infrastructure
- **ステータス**: 実装完了
- **説明**: CloudFormationによるIaC実装
- **ファイル**: `/infrastructure/cloudformation/roic-infrastructure.yaml`

**AWS リソース構成**:
- **S3バケット**: 静的サイトホスティング
  - ステージング環境: `roic-infrastructure-staging-website`
  - 本番環境: `roic-infrastructure-production-website`
- **CloudFront**: CDN配信、キャッシュ最適化
- **IAM**: 最小権限の原則に基づくロール設定
- **CloudWatch**: ログ監視、アラート設定
- **SNS**: デプロイ通知システム

#### データベース基盤
- **ステータス**: 接続確認済み
- **説明**: AWS RDS MariaDB 10.6
- **エンドポイント**: `roic-database.c123456789012.ap-northeast-1.rds.amazonaws.com`
- **接続状況**: ✅ 接続テスト成功

### 3.5.3 デプロイメント自動化 ✅

#### 自動デプロイスクリプト
- **ステージング**: `/scripts/deploy-staging.sh`
- **本番**: `/scripts/deploy-production.sh`

**主要機能**:
- 前提条件チェック（AWS CLI, Node.js, 認証情報）
- アプリケーションビルド・テスト実行
- 自動バックアップ作成（ステージング: 5世代、本番: 10世代保持）
- S3へのデプロイ（キャッシュ最適化）
- CloudFrontキャッシュ無効化
- 包括的ヘルスチェック（リトライロジック付き）
- 失敗時自動ロールバック

#### 環境管理
- **開発環境**: ローカル開発環境
- **ステージング環境**: テスト・検証用（自動デプロイ）
- **本番環境**: エンドユーザー向け（承認制デプロイ）

### 3.5.4 監視・運用 ✅

#### セキュリティ・品質管理
- **依存関係脆弱性スキャン**: npm audit, Safety
- **静的コード解析**: ESLint, SonarQube準備
- **コード品質ゲート**: 自動修正機能付き
- **セキュリティベストプラクティス**: 機密情報管理、アクセス制御

#### 運用監視
- **ヘルスチェック**: 自動監視、異常検知
- **ログ監視**: CloudWatch Logs集約
- **アラート**: CloudWatch Alarms、SNS通知
- **メトリクス**: パフォーマンス、エラー率監視

## 4. テスト状況

### 4.1 自動テスト実行状況
- **ユニットテスト**: 4件 (成功: 4, カバレッジ: 93%)
- **E2Eテスト**: 実装準備中 (カバレッジ: 70%)
- **統合テスト**: 実装準備中 (カバレッジ: 75%)

### 4.2 CI/CDテスト自動化
- **継続的テスト**: コミット毎の自動実行
- **テストレポート**: HTML形式、Jenkins統合
- **カバレッジ追跡**: コードカバレッジ継続監視
- **パフォーマンステスト**: 負荷テスト自動実行

## 5. 技術仕様

### 5.1 フロントエンド技術スタック
- **フレームワーク**: Next.js 14 (App Router)
- **言語**: TypeScript
- **スタイリング**: Tailwind CSS
- **状態管理**: Zustand
- **テスト**: Jest, React Testing Library, Playwright

### 5.2 バックエンド技術スタック
- **ランタイム**: Node.js 18
- **データベース**: AWS RDS MariaDB 10.6
- **API**: RESTful API設計
- **認証**: 準備中

### 5.3 インフラ・DevOps
- **クラウド**: AWS (S3, CloudFront, RDS, CloudWatch)
- **CI/CD**: Jenkins, GitHub Actions
- **IaC**: AWS CloudFormation
- **監視**: CloudWatch, SNS
- **セキュリティ**: IAM, VPC, SSL/TLS

## 6. 今後の拡張計画

### 6.1 短期計画（Phase 2）
- 業界比較・ランキング機能実装
- データ可視化（チャート・グラフ）
- E2E・統合テスト完全自動化

### 6.2 中期計画（Phase 3）
- EDINET API統合
- リアルタイムデータ更新
- ユーザー認証・権限管理

### 6.3 長期計画
- マルチリージョン展開
- マイクロサービス化
- AI/機械学習による予測分析

---

**更新履歴**
- 2025/7/1 15:48:54: 初版作成（自動生成）
- 2025/7/1 16:30:00: CI/CDパイプライン実装完了に伴う大幅更新
  - インフラストラクチャ・CI/CDセクション新設
  - Jenkins自動化パイプライン実装状況追加
  - AWS CloudFormation IaC実装状況追加
  - デプロイメント自動化機能詳細追加
  - 全体進捗を63%→75%に更新

*この文書は開発進捗に応じて自動更新されます*